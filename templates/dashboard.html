{% extends "base.html" %}

{% block title %}Dashboard - StudyMate{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">

<div class="vscode-layout">

    {% if active_topic %}
        {% include 'dashboard/topic.html' %}
    {% else %}
        {% include 'dashboard/main.html' %} 
    {% endif %} 
</div>

<div class="modal-backdrop" id="modalBackdrop" style="display: none;" onclick="closeCreateTopicModal()"></div>
<div class="create-topic-modal" id="createTopicModal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeCreateTopicModal()">&times;</span>
        <h2>Create Topic</h2>
        <!-- <form action="{{ url_for('auth.login') }}" method="POST"> -->
        <form id="createTopicForm" action="{{ url_for('topics.create_topic') }}" method="POST">
            <label for="name">Topic Name:</label>
            <input type="text" id="name" name="name" required>
            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea>
            <button type="submit">Create</button>
        </form>
    </div>
</div>

<script>
    // Panel switching logic
    document.querySelectorAll('.icon-item').forEach(icon => {
        icon.addEventListener('click', function() {
            const panelName = this.dataset.panel;
            if (!panelName) return;
            
            // Update active icon
            document.querySelectorAll('.icon-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            // Update active panel
            document.querySelectorAll('.panel-content').forEach(p => p.classList.remove('active'));
            document.getElementById(`panel-${panelName}`).classList.add('active');
        });
    });
    
    // Chat input auto-resize
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
    }
    
    // Send message functionality (placeholder)
    const sendBtn = document.getElementById('sendBtn');
    if (sendBtn) {
        sendBtn.addEventListener('click', function() {
            // TODO: Implement chat send functionality
            console.log('Send message:', chatInput.value);
        });
        
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendBtn.click();
            }
        });
    }

    // Create Topic Modal
    function createTopic() {
        document.getElementById('modalBackdrop').style.display = 'block';
        document.getElementById('createTopicModal').style.display = 'block';
        console.log('Create Topic button clicked');
    }

    function closeCreateTopicModal() {
        document.getElementById('modalBackdrop').style.display = 'none';
        document.getElementById('createTopicModal').style.display = 'none';
        console.log('Close Create Topic modal');
    }

</script>

{% endblock %}