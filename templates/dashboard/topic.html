<!-- TOPIC PAGE -->
<div class="topic-page">
    <!-- Back to Dashboard Link -->
    <a href="{{ url_for('dashboard') }}" class="back-to-dashboard">
        ‚Üê Back to Dashboard
    </a>

    <!-- Topic Header -->
    <div class="topic-header">
        <h1>{{ active_topic.name }}</h1>
        <p>{{ active_topic.description }}</p>
    </div>

    <!-- Action Buttons -->
    <div class="topic-actions">
        <a href="{{ url_for('note.create_note', topic_id=active_topic.id) }}" method="GET" class="btn-action">Add Note</a>
        <a href="#" onclick="addResource(); return false;" class="btn-action">Add Resource</a>
        <a href="#" onclick="addSubtopic(); return false;" class="btn-action">Add Subtopic</a>
    </div>

    <!-- Topic Content -->
    <div class="topic-content">
        <!-- Resources Section -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">üìö</span>
                Resources
            </h2>
            {% if active_topic.resources %}
                <div class="resources-grid">
                    {% for resource in active_topic.resources %}
                        <div class="resource-card">
                            <a href="{{ url_for('resource.view_resource', resource_id=resource.id) }}" class="resource-link">
                                <div class="resource-thumbnail {{ resource.resource_type|lower }}">
                                    {% if resource.is_pdf() %}
                                        üìÑ
                                    {% elif resource.is_link() %}
                                        üîó
                                    {% else %}
                                        ÔøΩ
                                    {% endif %}
                                </div>
                                <div class="resource-info">
                                    <div class="resource-title">{{ resource.title or 'Untitled Resource' }}</div>
                                    <div class="resource-type">
                                        {% if resource.is_pdf() %}
                                            PDF
                                        {% elif resource.is_link() %}
                                            Link
                                        {% else %}
                                            File
                                        {% endif %}
                                    </div>
                                    {% if resource.file_size %}
                                        <div class="resource-size">
                                            {% if resource.file_size < 1024 %}
                                                {{ resource.file_size }} B
                                            {% elif resource.file_size < 1048576 %}
                                                {{ "%.1f"|format(resource.file_size / 1024) }} KB
                                            {% else %}
                                                {{ "%.1f"|format(resource.file_size / 1048576) }} MB
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </a>
                            <form action="{{ url_for('resource.delete_resource', resource_id=resource.id) }}" method="POST" class="resource-delete-form">
                                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this resource?')" title="Delete resource">üóëÔ∏è</button>
                            </form>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìö</div>
                    <p>No resources added yet. Click "Add Resource" to include learning materials.</p>
                </div>
            {% endif %}
        </div>

        <!-- Notes Section -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">üìù</span>
                Notes
            </h2>
            {% if active_topic.notes %}
                <div class="notes-grid">
                    {% for note in active_topic.notes %}
                        <div class="note-card">
                            <a href="{{ url_for('note.view_note', note_id=note.id) }}" class="note-link">
                                <div class="note-header">
                                    <div class="note-icon">üìù</div>
                                    <div class="note-title">{{ note.title or 'Untitled Note' }}</div>
                                </div>
                                <div class="note-preview">
                                    {{ note.content[:100] }}{% if note.content|length > 100 %}...{% endif %}
                                </div>
                                <div class="note-meta">
                                    <span class="note-date">{{ note.created_at.strftime('%b %d, %Y') }}</span>
                                    {% if note.is_ai_generated %}
                                        <span class="ai-badge">ü§ñ AI</span>
                                    {% endif %}
                                </div>
                            </a>
                            <form action="{{ url_for('note.delete_note', note_id=note.id) }}" method="POST" class="note-delete-form">
                                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this note?')" title="Delete note">üóëÔ∏è</button>
                            </form>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <p>No notes created yet. Click "Add Note" to start taking notes.</p>
                </div>
            {% endif %}
        </div>

        <!-- Subtopic Section -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">üóÇÔ∏è</span>
                Subtopic
            </h2>
            {% if active_topic.subtopic %}
                <div class="subtopic-grid">
                    {% for subtopic in active_topic.subtopic %}
                        <div class="subtopic-card">
                            <div class="subtopic-icon">
                                {{ subtopic.emoji or 'üìå' }}
                            </div>
                            <div class="subtopic-content">
                                <div class="subtopic-title">{{ subtopic.name }}</div>
                                <div class="subtopic-description">
                                    {{ subtopic.description or 'No description provided' }}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üóÇÔ∏è</div>
                    <p>No subtopic created yet. Click "Add Subtopic" to organize this topic further.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="modal-backdrop" id="modalBackdrop" style="display: none;" onclick="closeCreateResourceModal()"></div>
<div class="create-resource-modal" id="createResourceModal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeCreateResourceModal()">&times;</span>
        <h2>Add Resource</h2>
        <form id="createResourceForm" action="{{ url_for('resource.create_resource', topic_id=active_topic.id) }}" method="POST" enctype="multipart/form-data">
            <label for="title">Resource Title:</label>
            <input type="text" id="title" name="title" required placeholder="Enter resource title">
            
            <label for="resource_type">Resource Type:</label>
            <select id="resource_type" name="resource_type" required onchange="toggleResourceFields()">
                <option value="">-- Select Type --</option>
                <option value="link">Link/URL</option>
                <option value="pdf">PDF Document</option>
            </select>
            
            <!-- URL field (shown when type is 'link') -->
            <div id="urlField" style="display: none;">
                <label for="url">URL:</label>
                <input type="url" id="url" name="url" placeholder="https://example.com">
            </div>
            
            <!-- File upload field (shown when type is 'pdf') -->
            <div id="fileField" style="display: none;">
                <label for="file">Upload PDF:</label>
                <input type="file" id="file" name="file" accept=".pdf">
                <small style="color: #666;">Max file size: 50MB</small>
            </div>
            
            <button type="submit">Create Resource</button>
        </form>
    </div>
</div>
<script>
    function createNote() {
        // Logic to create a new note
        document.getElementById('modalBackdrop').style.display = 'block';
        console.log('Create Note button clicked');
    }

    function closeCreateResourceModal() {
        document.getElementById('modalBackdrop').style.display = 'none';
        document.getElementById('createResourceModal').style.display = 'none';
        // Reset form
        document.getElementById('createResourceForm').reset();
        document.getElementById('urlField').style.display = 'none';
        document.getElementById('fileField').style.display = 'none';
    }

    function addResource() {
        // Logic to add a new resource
        document.getElementById('modalBackdrop').style.display = 'block';
        document.getElementById('createResourceModal').style.display = 'block';
        console.log('Add Resource button clicked');
    }

    function addSubtopic() {
        // Logic to add a new subtopic
        document.getElementById('modalBackdrop').style.display = 'block';
        console.log('Add Subtopic button clicked');
    }

    function toggleResourceFields() {
        const resourceType = document.getElementById('resource_type').value;
        const urlField = document.getElementById('urlField');
        const fileField = document.getElementById('fileField');
        const urlInput = document.getElementById('url');
        const fileInput = document.getElementById('file');
        
        // Hide all fields first
        urlField.style.display = 'none';
        fileField.style.display = 'none';
        
        // Remove required attribute from all
        urlInput.removeAttribute('required');
        fileInput.removeAttribute('required');
        
        // Show and require the appropriate field
        if (resourceType === 'link') {
            urlField.style.display = 'block';
            urlInput.setAttribute('required', 'required');
        } else if (resourceType === 'pdf') {
            fileField.style.display = 'block';
            fileInput.setAttribute('required', 'required');
        }
    }

</script>