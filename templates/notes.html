{% extends "base.html" %}

{% block title %}Notes - StudyMate{% endblock %}

{% block content %}
<style>
    body {
        background: #1e1e1e;
        margin: 0;
        padding: 0;
        display: block;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .notes-container {
        width: 100%;
        height: 100vh;
        background: #252526;
        display: flex;
        flex-direction: column;
        padding: 0;
    }

    .toolbar {
        background: #2d2d30;
        padding: 8px 20px;
        border-bottom: 1px solid #3e3e42;
        display: flex;
        gap: 12px;
        align-items: center;
        flex-shrink: 0;
    }

    .toolbar-btn {
        padding: 6px 12px;
        background: #3c3c3c;
        border: 1px solid #3e3e42;
        border-radius: 4px;
        color: #cccccc;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .toolbar-btn:hover {
        background: #4a4a4a;
        border-color: #5a5a5a;
    }

    .toolbar-btn.primary {
        background: #007acc;
        color: white;
        border-color: #007acc;
    }

    .toolbar-btn.primary:hover {
        background: #0098ff;
        border-color: #0098ff;
    }

    .back-link {
        color: #007acc;
        text-decoration: none;
        font-size: 13px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .back-link:hover {
        text-decoration: underline;
        color: #0098ff;
    }

    .toolbar-spacer {
        flex: 1;
    }

    .notes-content {
        flex: 1;
        overflow-y: auto;
        padding: 40px 80px;
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
    }

    .notes-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #3e3e42;
    }

    .notes-title {
        font-size: 32px;
        color: #e0e0e0;
        font-weight: 600;
        margin-bottom: 12px;
        padding: 8px 0;
        border: none;
        width: 100%;
        outline: none;
        background: transparent;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    .notes-title::placeholder {
        color: #6a6a6a;
    }

    .notes-title:focus {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 4px;
        padding: 8px 12px;
    }

    .notes-meta {
        font-size: 12px;
        color: #858585;
        padding: 0 0;
        display: flex;
        gap: 12px;
    }

    .notes-editor {
        min-height: calc(100vh - 300px);
        font-size: 16px;
        line-height: 1.7;
        color: #d4d4d4;
        padding: 12px 0;
        border: none;
        outline: none;
        width: 100%;
        background: transparent;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        resize: none;
    }

    .notes-editor::placeholder {
        color: #6a6a6a;
    }

    .notes-editor:focus {
        background: rgba(255, 255, 255, 0.02);
        border-radius: 4px;
        padding: 12px;
    }

    /* Custom scrollbar for dark mode */
    .notes-content::-webkit-scrollbar {
        width: 12px;
    }

    .notes-content::-webkit-scrollbar-track {
        background: #1e1e1e;
    }

    .notes-content::-webkit-scrollbar-thumb {
        background: #3e3e42;
        border-radius: 6px;
    }

    .notes-content::-webkit-scrollbar-thumb:hover {
        background: #4a4a4a;
    }
</style>

<div class="notes-container">
    <div class="toolbar">
        <a href="{{ url_for('topics.view_topic', topic_id=topic_id) if topic_id else url_for('dashboard') }}" class="back-link">
            ← Back to Topic
        </a>
        <div class="toolbar-spacer"></div>
        <button class="toolbar-btn" onclick="formatText('bold')"><b>B</b></button>
        <button class="toolbar-btn" onclick="formatText('italic')"><i>I</i></button>
        <button class="toolbar-btn" onclick="formatText('underline')"><u>U</u></button>
        <button class="toolbar-btn primary" onclick="saveNotes()">Save</button>
    </div>

    <div class="notes-content">
        <div class="notes-header">
            <input type="text" class="notes-title" placeholder="Untitled Note" value="{{ note.title if note else '' }}">
            <div class="notes-meta">
                <span id="lastSaved">Last saved: Never</span>
                <span>•</span>
                <span id="wordCount">0 words</span>
            </div>
        </div>

        <textarea class="notes-editor" placeholder="Start typing your notes here...">{{ note.content if note else '' }}</textarea>
    </div>
</div>

<script>
    const editor = document.querySelector('.notes-editor');
    const titleInput = document.querySelector('.notes-title');
    const wordCountSpan = document.getElementById('wordCount');
    const lastSavedSpan = document.getElementById('lastSaved');

    // Auto-resize textarea
    function autoResize() {
        editor.style.height = 'auto';
        editor.style.height = Math.max(600, editor.scrollHeight) + 'px';
    }

    editor.addEventListener('input', () => {
        autoResize();
        updateWordCount();
    });

    // Update word count
    function updateWordCount() {
        const text = editor.value.trim();
        const words = text ? text.split(/\s+/).length : 0;
        wordCountSpan.textContent = `${words} word${words !== 1 ? 's' : ''}`;
    }

    // Save notes
    function saveNotes() {
        const title = titleInput.value || 'Untitled Note';
        const content = editor.value;
        const is_ai_generated = false;

        // TODO: Add actual save functionality with backend
        console.log('Saving:', { title, content, is_ai_generated});

        // Update last saved time
        const now = new Date();
        lastSavedSpan.textContent = `Last saved: ${now.toLocaleTimeString()}`;

        // TODO: Add actual save functionality with backend
        fetch(`{{ url_for('topics.save_note', topic_id=topic_id) }}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, content, is_ai_generated})
        })
        .then(response => {
            if (response.ok) {
                console.log('Note saved successfully');
            } else {
                console.error('Error saving note');
            }
        });

        // Visual feedback
        const saveBtn = document.querySelector('.toolbar-btn.primary');
        const originalText = saveBtn.textContent;
        saveBtn.textContent = 'Saved!';
        setTimeout(() => {
            saveBtn.textContent = originalText;
        }, 2000);
    }

    // Format text (basic placeholder - would need contentEditable for full formatting)
    function formatText(format) {
        // This is a simple placeholder
        // For real formatting, you'd want to use a rich text editor library
        console.log('Format:', format);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 's') {
            e.preventDefault();
            saveNotes();
        }
    });

    // Initialize
    autoResize();
    updateWordCount();
</script>
{% endblock %}
