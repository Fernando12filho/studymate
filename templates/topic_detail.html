{% extends "base.html" %}

{% block title %}{{ topic.name }} - StudyMate{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">

<div class="vscode-layout">
    <!-- LEFT SIDEBAR: Navigation Icons + Expandable Panel -->
    <div class="sidebar-container">
        <!-- Icon Bar -->
        <div class="icon-bar">
            <div class="icon-item active" data-panel="subtopics" title="Subtopics">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
            </div>
            
            <div class="icon-item" data-panel="resources" title="Resources">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                    <polyline points="13 2 13 9 20 9"></polyline>
                </svg>
            </div>
            
            <div class="icon-item" data-panel="notes" title="Notes">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </div>
            
            <div class="icon-item" data-panel="exercises" title="Exercises">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
            </div>
            
            <div class="spacer"></div>
            
            <div class="icon-item" title="Edit Topic">
                <a href="{{ url_for('topics.update_topic', topic_id=topic.id) }}" style="color: inherit; text-decoration: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </a>
            </div>
            
            <div class="icon-item" title="Back to Dashboard">
                <a href="{{ url_for('dashboard') if not topic.parent_topic_id else url_for('topics.view_topic', topic_id=topic.parent_topic_id) }}" style="color: inherit; text-decoration: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </a>
            </div>
            
            <div class="icon-item" title="Logout">
                <a href="{{ url_for('auth.logout') }}" style="color: inherit; text-decoration: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </a>
            </div>
        </div>
        
        <!-- Expandable Side Panel -->
        <div class="side-panel" id="sidePanel">
            <!-- SUBTOPICS PANEL -->
            <div class="panel-content active" id="panel-subtopics">
                <div class="panel-header">
                    <h2>Subtopics</h2>
                    {% if not topic.is_subtopic() %}
                    <button class="btn-icon" title="Add Subtopic" onclick="window.location.href='{{ url_for('topics.create_topic', parent_id=topic.id) }}'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    {% endif %}
                </div>
                <div class="panel-body">
                    {% if topic.is_subtopic() %}
                        <p class="placeholder-text">Subtopics cannot have sub-subtopics</p>
                    {% elif topic.subtopics %}
                        {% for subtopic in topic.subtopics %}
                        <div class="list-item" onclick="window.location.href='{{ url_for('topics.view_topic', topic_id=subtopic.id) }}'">
                            <span class="item-icon">üìÅ</span>
                            <span class="item-title">{{ subtopic.name }}</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="placeholder-text">No subtopics yet. Break this topic into smaller parts!</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- RESOURCES PANEL -->
            <div class="panel-content" id="panel-resources">
                <div class="panel-header">
                    <h2>Resources</h2>
                    <button class="btn-icon" title="Add Resource">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                <div class="panel-body">
                    <p class="placeholder-text">No resources yet. Add articles, videos, or documents to study!</p>
                </div>
            </div>
            
            <!-- NOTES PANEL -->
            <div class="panel-content" id="panel-notes">
                <div class="panel-header">
                    <h2>Notes</h2>
                    <button class="btn-icon" title="New Note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                <div class="panel-body">
                    <p class="placeholder-text">No notes yet. Start taking notes about this topic!</p>
                </div>
            </div>
            
            <!-- EXERCISES PANEL -->
            <div class="panel-content" id="panel-exercises">
                <div class="panel-header">
                    <h2>Exercises</h2>
                    <button class="btn-icon" title="Generate Exercises">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                    </button>
                </div>
                <div class="panel-body">
                    <p class="placeholder-text">Generate AI exercises to test your knowledge!</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MAIN CONTENT AREA -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="content-title">{{ topic.name }}</h1>
            <div class="breadcrumb">
                <span><a href="{{ url_for('dashboard') }}">Dashboard</a></span>
                {% if topic.parent_topic %}
                    <span> / <a href="{{ url_for('topics.view_topic', topic_id=topic.parent_topic.id) }}">{{ topic.parent_topic.name }}</a></span>
                {% endif %}
                <span> / {{ topic.name }}</span>
            </div>
        </div>
        
        <div class="content-body">
            <!-- Topic Overview -->
            <div class="topic-overview">
                <div class="topic-header-section">
                    <div class="topic-meta">
                        <span class="meta-badge">{{ 'Subtopic' if topic.is_subtopic() else 'Topic' }}</span>
                        <span class="meta-info">Created {{ topic.created_at.strftime('%B %d, %Y') }}</span>
                        {% if topic.updated_at != topic.created_at %}
                            <span class="meta-info">Updated {{ topic.updated_at.strftime('%B %d, %Y') }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="topic-actions">
                        <button class="btn-secondary" onclick="window.location.href='{{ url_for('topics.update_topic', topic_id=topic.id) }}'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit
                        </button>
                        <button class="btn-danger" onclick="if(confirm('Are you sure you want to delete this topic? This action cannot be undone.')) document.getElementById('deleteForm').submit()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                            Delete
                        </button>
                        <form id="deleteForm" method="POST" action="{{ url_for('topics.delete_topic', topic_id=topic.id) }}" style="display: none;"></form>
                    </div>
                </div>
                
                {% if topic.description %}
                <div class="topic-description">
                    <h3>Description</h3>
                    <p>{{ topic.description }}</p>
                </div>
                {% endif %}
                
                <!-- Action Cards -->
                <div class="welcome-section">
                    {% if not topic.is_subtopic() %}
                    <div class="welcome-card">
                        <h2>üìÅ Create Subtopic</h2>
                        <p>Break this topic into smaller, more focused subtopics</p>
                        <button class="btn-primary" onclick="window.location.href='{{ url_for('topics.create_topic', parent_id=topic.id) }}'">Add Subtopic</button>
                    </div>
                    {% endif %}
                    
                    <div class="welcome-card">
                        <h2>üìö Add Resources</h2>
                        <p>Add links to articles, videos, and other learning materials</p>
                        <button class="btn-secondary">Add Resource</button>
                    </div>
                    
                    <div class="welcome-card">
                        <h2>‚úçÔ∏è Take Notes</h2>
                        <p>Write and organize notes for this topic</p>
                        <button class="btn-secondary">Create Note</button>
                    </div>
                    
                    <div class="welcome-card">
                        <h2>ü§ñ Practice with AI</h2>
                        <p>Generate exercises to test your knowledge</p>
                        <button class="btn-secondary">Generate Exercises</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- RIGHT PANEL: AI Agent Chat -->
    <div class="chat-panel">
        <div class="chat-header">
            <div class="chat-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>AI Study Assistant</span>
            </div>
            <button class="btn-icon" title="Clear Chat">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            </button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="chat-welcome">
                <div class="ai-avatar">ü§ñ</div>
                <h3>Studying: {{ topic.name }}</h3>
                <p>I can help you with this topic!</p>
                <ul>
                    <li>Generate practice questions</li>
                    <li>Explain concepts</li>
                    <li>Suggest study resources</li>
                </ul>
                <p class="chat-hint">Ask me anything about {{ topic.name }}!</p>
            </div>
        </div>
        
        <div class="chat-input-container">
            <textarea 
                class="chat-input" 
                placeholder="Ask about {{ topic.name }}..."
                rows="1"
                id="chatInput"
            ></textarea>
            <button class="btn-send" id="sendBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
</div>

<style>
.topic-overview {
    max-width: 1200px;
    margin: 0 auto;
}

.topic-header-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--vscode-panel-border);
}

.topic-meta {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
}

.meta-badge {
    background: var(--vscode-badge-background);
    color: var(--vscode-badge-foreground);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
}

.meta-info {
    color: var(--vscode-descriptionForeground);
    font-size: 0.9rem;
}

.topic-actions {
    display: flex;
    gap: 0.75rem;
}

.btn-danger {
    background: var(--vscode-errorForeground);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: opacity 0.2s;
}

.btn-danger:hover {
    opacity: 0.8;
}

.topic-description {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: var(--vscode-editor-background);
    border-radius: 6px;
    border: 1px solid var(--vscode-panel-border);
}

.topic-description h3 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
    color: var(--vscode-foreground);
}

.topic-description p {
    margin: 0;
    line-height: 1.6;
    color: var(--vscode-descriptionForeground);
    white-space: pre-wrap;
}

.breadcrumb a {
    color: var(--vscode-textLink-foreground);
    text-decoration: none;
}

.breadcrumb a:hover {
    text-decoration: underline;
}

.list-item {
    cursor: pointer;
}

.list-item:hover {
    background: var(--vscode-list-hoverBackground);
}
</style>

<script>
    // Panel switching logic
    document.querySelectorAll('.icon-item').forEach(icon => {
        icon.addEventListener('click', function() {
            const panelName = this.dataset.panel;
            if (!panelName) return;
            
            // Update active icon
            document.querySelectorAll('.icon-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            // Update active panel
            document.querySelectorAll('.panel-content').forEach(p => p.classList.remove('active'));
            document.getElementById(`panel-${panelName}`).classList.add('active');
        });
    });
    
    // Chat input auto-resize
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
    }
    
    // Send message functionality (placeholder)
    const sendBtn = document.getElementById('sendBtn');
    if (sendBtn) {
        sendBtn.addEventListener('click', function() {
            console.log('Send message:', chatInput.value);
        });
        
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendBtn.click();
            }
        });
    }
</script>

{% endblock %}
