<!-- RIGHT PANEL: AI Agent Chat -->
<div class="chat-panel" id="chatPanel">
    <div class="chat-header">
        <div class="chat-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>AI Study Assistant</span>
        </div>
        <div class="chat-header-actions">
            <button class="btn-icon" onclick="toggleChat()" title="Minimize Chat">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
            <button class="btn-icon" title="Clear Chat">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <div class="chat-messages" id="chatMessages">
        <!-- TODO: Insert chat messages here -->
        <!-- Example structure:
        <div class="message user-message">
            <div class="message-content">Hello!</div>
        </div>
        <div class="message ai-message">
            <div class="message-content">Hi! How can I help you study today?</div>
        </div>
        -->
        <div class="chat-welcome">
            <div class="ai-avatar">ðŸ¤–</div>
            <h3>Hello! I'm your AI Study Assistant</h3>
            <p>I can help you:</p>
            <ul>
                <li>Generate practice exercises</li>
                <li>Answer questions about your notes</li>
                <li>Suggest study strategies</li>
            </ul>
            <p class="chat-hint">Start by asking me anything!</p>
        </div>
    </div>
    
    <div class="chat-input-container">
        <textarea 
            class="chat-input" 
            placeholder="Ask me anything about your studies..."
            rows="1"
            id="chatInput"
        ></textarea>
        <button class="btn-send" id="sendBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        </button>
    </div>
</div>

<!-- Floating Chat Button (visible when chat is minimized) -->
<button class="floating-chat-btn" id="floatingChatBtn" onclick="toggleChat()" title="Open Chat" style="display: none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
</button>

<script>
    // Chat state persistence
    const CHAT_STATE_KEY = 'studymate_chat_minimized';
    
    function toggleChat() {
        const chatPanel = document.getElementById('chatPanel');
        const floatingBtn = document.getElementById('floatingChatBtn');
        
        if (chatPanel.classList.contains('minimized')) {
            // Open chat
            chatPanel.classList.remove('minimized');
            floatingBtn.style.display = 'none';
            localStorage.setItem(CHAT_STATE_KEY, 'false');
        } else {
            // Minimize chat
            chatPanel.classList.add('minimized');
            floatingBtn.style.display = 'flex';
            localStorage.setItem(CHAT_STATE_KEY, 'true');
        }
    }
    
    // Restore chat state on page load
    function initializeChatState() {
        const chatPanel = document.getElementById('chatPanel');
        const floatingBtn = document.getElementById('floatingChatBtn');
        const isMinimized = localStorage.getItem(CHAT_STATE_KEY) === 'true';
        
        if (isMinimized) {
            chatPanel.classList.add('minimized');
            floatingBtn.style.display = 'flex';
        } else {
            chatPanel.classList.remove('minimized');
            floatingBtn.style.display = 'none';
        }
    }
    
    // Initialize state when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChatState);
    } else {
        initializeChatState();
    }
</script>
